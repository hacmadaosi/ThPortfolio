<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ThPortfolio</title>
    <link rel="icon" type="image/png" href="../resource/Logo.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- <script src="../js/Logic_Controller.js"></script> -->
    <script type="module" src="../js/UI_Controller.js"></script>
    <link rel="stylesheet" href="../css/style.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../data/data.js"></script>
  </head>
  <body class="bg-[#F2F8FC]">
    <!-- Hiển thị thông báo -->
    <div
      id="notification"
      class="hidden fixed right-0 top-0 bg-[#F3FDF5] pt-4 z-[2] mr-2 mt-2 w-[18rem]"
    >
      <div
        id="notify-title"
        class="flex gap-2 items-center text-green-400 mx-4 mb-2"
      >
        <i id="success-icon" class="fa-solid fa-circle-check text-xl"></i>
        <i
          id="error-icon"
          class="fa-solid fa-circle-exclamation text-xl hidden"
        ></i>
        <p class="font-bold">Thông báo</p>
      </div>
      <p id="notify-content" class="font-light text-sm ml-8 pr-4">
        Phải có 1 thông báo gì đó.
      </p>
      <div
        id="notify-line"
        class="pt-4 border-b-4 border-green-400 notification-line"
      ></div>
    </div>

    <!-- giao diện xác thực tài khoản -->
    <div
      id="auth-form"
      class="hidden fixed bg-black bg-opacity-50 w-full h-screen flex items-center justify-center z-[1]"
    >
      <!-- Đăng nhập -->
      <div
        id="login-form"
        class="relative h-[95vh] w-[60vh] pt-20 pb-5 lg:px-16 px-8 rounded-xl bg-white mx-2 justify-center flex flex-col lg:text-base text-xs"
      >
        <button
          id="close_login_form"
          class="w-4 h-4 p-4 rounded-full flex items-center justify-center bg-transparent absolute top-0 right-0 mr-4 mt-4 active:scale-95 hover:bg-white"
        >
          <i class="fa-solid fa-xmark"></i>
        </button>
        <h1 id="title-auth-form" class="text-4xl font-bold mb-8">Đăng nhập</h1>
        <!-- Nhập email -->
        <!-- <form  action="#trang-chu" method="post" class="flex flex-col "> -->
        <div
          id="email-textfield"
          class="hidden flex p-2 gap-5 border-b-2 border-black items-center mb-4"
        >
          <i class="fa-solid fa-envelope"></i>
          <input
            id="email-input"
            class="focus:outline-none bg-transparent w-full"
            type="email"
            placeholder="Email"
          />
        </div>
        <!-- Nhập tên tên tài khoản -->
        <div class="flex p-2 gap-5 border-b-2 border-black items-center mb-4">
          <i class="fa-solid fa-user"></i>
          <input
            id="user-input"
            class="focus:outline-none bg-transparent w-full"
            type="text"
            placeholder="Tên đăng nhập"
          />
          <button
            id="clear-user-input"
            type="button"
            class="active:scale-95 hidden"
          >
            <i class="fa-solid fa-circle-xmark"></i>
          </button>
        </div>

        <!-- Nhập mật khẩu -->
        <div class="flex p-2 gap-5 border-b-2 border-black items-center mb-4">
          <div id="lock-icon">
            <i class="fa-solid fa-lock"></i>
          </div>
          <div id="unlock-icon" class="hidden">
            <i class="fa-solid fa-unlock"></i>
          </div>
          <input
            id="pass-input"
            class="focus:outline-none bg-transparent w-full"
            placeholder="Mật khẩu"
          />
          <button id="show-pass" class="active:scale-95 hidden" type="button">
            <i class="fa-solid fa-eye"></i>
          </button>
          <button id="hide-pass" class="active:scale-95 hidden" type="button">
            <i class="fa-solid fa-eye-slash"></i>
          </button>
        </div>
        <!-- Nhập xác nhận mật khẩu -->
        <div
          id="confirm-textfield"
          class="hidden flex p-2 gap-5 border-b-2 border-black items-center mb-4 none"
        >
          <div>
            <i class="fa-solid fa-lock"></i>
          </div>
          <input
            id="confirm-input"
            class="focus:outline-none bg-transparent w-full"
            placeholder="Xác nhận mật khẩu"
          />
          <button
            id="show-confirm-pass"
            class="active:scale-95 hidden"
            type="button"
          >
            <i class="fa-solid fa-eye"></i>
          </button>
          <button
            id="hide-confirm-pass"
            class="active:scale-95 hidden"
            type="button"
          >
            <i class="fa-solid fa-eye-slash"></i>
          </button>
        </div>
        <button
          type="button"
          class="active:scale-95 w-fit ml-auto text-gray-500"
        >
          Quên mật khẩu?
        </button>
        <div class="mb-4 mt-8 flex justify-center">
          <button
            id="submit-button"
            class="font-bold text-white rounded-lg px-10 py-2 bg-sky-400 active:scale-95"
          >
            Đăng nhập
          </button>
        </div>
        <!-- </form> -->
        <div class="flex justify-center items-center gap-10">
          <div class="flex-grow h-px bg-black"></div>
          <span>Hoặc</span>
          <div class="flex-grow h-px bg-black"></div>
        </div>
        <div class="mb-auto">
          <div id="firebaseui-auth-container"></div>
        </div>
        <button
          id="create-account"
          type="button"
          class="border-black border py-2 active:scale-95"
        >
          Tạo tài khoản
        </button>
      </div>
    </div>

    <!-- Navigationbar -->
    <div id="naviagtion-bar"></div>
    <script>
      fetch("../components/NavigationBar.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("naviagtion-bar").innerHTML = html;
          const btn_OpenAuthForm = document.getElementById(
            "navButtonOpenLoginForm"
          );
          btn_OpenAuthForm.textContent = JSON.parse(
            localStorage.getItem("user")
          )
            ? JSON.parse(localStorage.getItem("user")).HoTen
            : "Đăng nhập";
          const form_AuthForm = document.getElementById("auth-form");
          const user = JSON.parse(localStorage.getItem("user"));
          if (user) {
            btn_OpenAuthForm.textContent = user.Hoten;
          }
          btn_OpenAuthForm.addEventListener("click", () => {
            if (!user) {
              form_AuthForm.classList.toggle("hidden");
            } else {
              window.location.href = "./user.html";
            }
          });
        });
    </script>

    <!-- Nội dung chính -->
    <div class="pt-[72px]">
      <div class="flex justify-between px-10 py-5 bg-gray-100">
        <span class="text-4xl">Templates</span>
        <button class="text-xs" onclick="window.history.go(-1)">
          Quay lại
        </button>
      </div>

      <div class="flex flex-col px-24 mt-8">
        <!-- Tiêu đề -->
        <span class="font-bold text-3xl" id="tpDetail_TieuDe">Tiêu đề</span>
        <!-- Tác giả -->
        <div class="space-x-1 mt-2">
          <i class="fa-regular fa-user"></i>
          <span id="tpDetail_TacGia"> Tác giả</span>
        </div>
        <!-- Hình ảnh minha họa -->
        <img id="tpDetail_HinhAnh" class="mt-12 mx-28" alt="Ảnh minh họa" />
        <div class="mt-28 flex">
          <!-- Thông tin thêm -->
          <div class="flex flex-col w-[30%] gap-2">
            <span class="text-2xl font-medium">Thông tin thêm</span>
            <span id="tpDetail_NgayDang">Ngày đăng</span>
          </div>
          <!-- Mô tả -->
          <div class="flex flex-col w-full gap-2">
            <span class="text-2xl font-medium">Mô tả</span>
            <span id="tpDetail_MoTa">Phải có nội dung gì đó.</span>
          </div>
          <script>
            const _id = new URLSearchParams(window.location.search).get("id");
            const template = JSON.parse(localStorage.getItem("templates")).find(
              (e) => e.id == _id
            );
            console.log(template);
            const TacGia = document.getElementById("tpDetail_TacGia");
            TacGia.textContent = template.TacGia;
            const TieuDe = document.getElementById("tpDetail_TieuDe");
            TieuDe.textContent = template.TieuDe;
            const HinhAnh = document.getElementById("tpDetail_HinhAnh");
            HinhAnh.src = template.LienKetAnh;
            const NgayDang = document.getElementById("tpDetail_NgayDang");
            NgayDang.textContent = "Ngày đăng: " + template.NgayDang;
            const MoTa = document.getElementById("tpDetail_MoTa");
            MoTa.textContent = template.MoTa;
          </script>
        </div>
        <div class="flex pt-2 text-2xl font-bold">
          <p>Giá: <span id="tpDetail_Gia" class="text-sky-400">0 vnđ</span></p>
        </div>
        <!-- Nút thêm vào giỏ hàng -->
        <div
          id="tpDetail_buttonAddToCard"
          class="py-12 w-full flex justify-end"
        ></div>

        <!-- Thông tin đánh giá -->
        <div
          class="bg-gray-200 w-full mb-12 p-8 flex flex-col gap-8 rounded-xl"
        >
          <span class="font-medium text-xl gap-8">Đánh giá</span>
          <div
            id="tpDetail_listRates"
            class="bg-white p-4 flex flex-col rounded-xl"
          ></div>
          <script>
            const Gia = document.getElementById("tpDetail_Gia");
            Gia.textContent = `${template.Gia.toLocaleString("vi-VN")} vnđ`;
            fetch("../components/CardRate.html")
              .then((res) => res.text())
              .then((widget) => {
                const listRates = document.getElementById("tpDetail_listRates");
                const listRate = Rates.filter((e) => e.templateId == _id);
                if (listRate && listRate.length > 0)
                  listRate.map((e) => {
                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = widget
                      .replace("{{Rate}}", e.rating * 20)
                      .replace("{{Content}}", e.content)
                      .replace("{{Date}}", e.date)
                      .replace(
                        "{{UserName}}",
                        Users.find((u) => u.id === e.userId).fullName
                      );
                    const card = tempDiv.firstElementChild;
                    const btn = card.querySelector(".btnRate");
                    const menu = card.querySelector(".cardRateMenu");

                    btn.onclick = (e) => {
                      document
                        .querySelectorAll(".cardRateMenu")
                        .forEach((m) => {
                          if (m !== menu) m.classList.add("hidden");
                        });

                      menu.classList.toggle("hidden");
                      e.stopPropagation();
                    };
                    document.addEventListener("click", () => {
                      document
                        .querySelectorAll(".cardRateMenu")
                        .forEach((m) => m.classList.add("hidden"));
                    });
                    listRates.append(card);
                  });
                else {
                  const emptyMessage = document.createElement("p");
                  emptyMessage.classList = "w-full flex justify-center";
                  emptyMessage.textContent = "Chưa có đánh giá nào.";
                  listRates.append(emptyMessage);
                }
              });
          </script>
          <div
            id="tpDetail_buttonOpenRateDialog"
            class="w-full flex justify-center"
          ></div>
        </div>
      </div>
    </div>
    <script>
      fetch("../components/Button.html")
        .then((res) => res.text())
        .then((widget) => {
          // Nút thêm vào g
          const buttonAddToCard = document.getElementById(
            "tpDetail_buttonAddToCard"
          );
          buttonAddToCard.innerHTML = widget.replace(
            "{{TieuDe}}",
            "Thêm vào giỏ hàng"
          );
          buttonAddToCard.firstElementChild.addEventListener("click", () => {
            alert("hahaha");
          });
          // Nút thêm đánh giá
          const buttonOpenRateDialog = document.getElementById(
            "tpDetail_buttonOpenRateDialog"
          );
          buttonOpenRateDialog.innerHTML = widget.replace(
            "{{TieuDe}}",
            "Viết đánh giá"
          );
          buttonOpenRateDialog.firstElementChild.addEventListener(
            "click",
            () => {
              alert("hahaha");
            }
          );
        });
    </script>

    <!-- Footer -->
    <div id="footer"></div>
    <script>
      fetch("../components/Footer.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("footer").innerHTML = html;
        });
    </script>
  </body>
</html>
